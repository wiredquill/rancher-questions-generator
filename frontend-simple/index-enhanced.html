<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rancher Questions Generator - Enhanced</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; background: #f5f7fa; }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; 
                 border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .header h1 { margin: 0; font-size: 2.5em; }
        .header p { margin: 10px 0 0 0; opacity: 0.9; }
        
        /* Tabs */
        .tabs { display: flex; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
               margin-bottom: 20px; overflow hidden; }
        .tab { padding: 18px 30px; cursor: pointer; border: none; background: none; font-size: 16px; 
              transition: all 0.3s; flex: 1; text-align: center; }
        .tab.active { background: #667eea; color: white; }
        .tab:hover:not(.active) { background: #f8f9fa; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Sections */
        .section { margin-bottom: 20px; padding: 30px; background: white; border-radius: 12px; 
                   box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .section h3 { margin-top: 0; color: #2d3748; display: flex; align-items: center; gap: 10px; }
        
        /* Repository Browser */
        .repo-browser { display: grid; grid-template-columns: 300px 1fr; gap: 20px; height: 60vh; }
        .repo-list, .chart-list { background: #f8f9fa; padding: 20px; border-radius: 8px; overflow-y: auto; }
        
        .repo-item, .chart-item { 
            margin: 10px 0; padding: 15px; background: white; border: 1px solid #e2e8f0; 
            border-radius: 8px; cursor: pointer; transition: all 0.2s;
        }
        .repo-item:hover, .chart-item:hover { border-color: #667eea; transform: translateY(-1px); 
                                             box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15); }
        .repo-item.selected, .chart-item.selected { border-color: #667eea; background: #eef2ff; }
        
        .chart-meta { font-size: 12px; color: #718096; margin-top: 8px; }
        .chart-versions { margin-top: 10px; }
        .version-selector { padding: 6px; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 12px; }
        
        /* Form Builder */
        .main-content { display: grid; grid-template-columns: 400px 1fr; gap: 20px; height: 70vh; }
        .panel { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
                overflow-y: auto; }
        
        .values-panel { background: #f8f9fa; }
        .form-builder { position: relative; }
        .form-builder.dragover { background: #eef2ff; border: 2px dashed #667eea; }
        
        /* Values Display */
        .values-tree { font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace; font-size: 13px; 
                      line-height: 1.6; }
        .value-item { 
            padding: 8px 12px; margin: 3px 0; background: white; border: 1px solid #e2e8f0; 
            cursor: grab; border-radius: 6px; transition: all 0.2s; display: flex; 
            justify-content: space-between; align-items: center;
        }
        .value-item:hover { background: #eef2ff; border-color: #667eea; }
        .value-item:active { cursor: grabbing; }
        
        .value-path { font-weight: 600; color: #2d3748; }
        .value-type { font-size: 11px; color: #718096; background: #f7fafc; padding: 2px 6px; 
                     border-radius: 12px; }
        .value-default { color: #38a169; font-weight: 500; font-size: 12px; }
        .value-comment { color: #718096; font-style: italic; font-size: 11px; margin-left: 10px; }
        
        /* Questions */
        .question-item { 
            margin: 15px 0; padding: 20px; border: 1px solid #667eea; background: #f7fafc; 
            border-radius: 8px; position: relative; transition: all 0.2s; cursor: move;
        }
        .question-item.dragging { opacity: 0.5; transform: rotate(2deg); }
        .question-item.drag-over { border-color: #48bb78; background: #f0fff4; }
        .question-item:hover { box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15); }
        .question-item [disabled] { opacity: 0.5; cursor: not-allowed; }
        
        .question-header { display: flex; justify-content: space-between; align-items: flex-start; 
                          margin-bottom: 12px; }
        .question-title { font-weight: 600; color: #2d3748; font-size: 16px; }
        .question-controls { display: flex; gap: 8px; }
        
        .question-details { background: white; padding: 12px; border-radius: 6px; font-size: 13px; 
                          color: #4a5568; }
        .question-meta { display: flex; gap: 8px; margin-top: 8px; }
        .meta-tag { background: #edf2f7; color: #4a5568; padding: 4px 8px; border-radius: 12px; 
                   font-size: 11px; }
        
        .question-edit { background: white; margin-top: 15px; padding: 20px; border-radius: 8px; 
                        border: 1px solid #e2e8f0; display: none; }
        .question-edit.active { display: block; }
        
        /* Quick Add */
        .quick-add { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; 
                    padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .quick-add h4 { margin: 0 0 15px 0; }
        .quick-add-buttons { display: flex; gap: 12px; flex-wrap: wrap; }
        .quick-add-buttons button { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); 
                                   color: white; padding: 10px 16px; border-radius: 6px; font-size: 14px; }
        .quick-add-buttons button:hover { background: rgba(255,255,255,0.3); }
        
        /* Advanced Question Editor */
        .advanced-editor { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 15px; }
        .advanced-editor h4 { margin: 0 0 15px 0; color: #2d3748; }
        .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0; }
        .field-group { margin: 15px 0; }
        .field-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568; }
        .options-editor { margin-top: 10px; }
        .option-item { display: flex; gap: 10px; align-items: center; margin: 8px 0; }
        .option-item input { flex: 1; }
        .remove-option { background: #e53e3e; color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; }
        .add-option { background: #38a169; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px; }
        
        /* Section Templates */
        .template-library { background: #edf2f7; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .template-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px; }
        .template-item { background: white; padding: 15px; border-radius: 8px; cursor: pointer; transition: all 0.2s; border: 1px solid #e2e8f0; }
        .template-item:hover { border-color: #667eea; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15); }
        .template-title { font-weight: 600; color: #2d3748; margin-bottom: 8px; }
        .template-desc { font-size: 12px; color: #718096; }
        .template-questions { font-size: 11px; color: #a0aec0; margin-top: 5px; }
        
        /* Form Controls */
        button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; 
                font-weight: 500; transition: all 0.2s; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a67d8; }
        .btn-secondary { background: #718096; color: white; }
        .btn-secondary:hover { background: #4a5568; }
        .btn-success { background: #38a169; color: white; }
        .btn-danger { background: #e53e3e; color: white; }
        .btn-small { padding: 6px 12px; font-size: 12px; }
        
        input, select, textarea { padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; 
                                 font-size: 14px; transition: border-color 0.2s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; 
                                                   box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        input[type="text"], select { width: 250px; }
        textarea { width: 100%; height: 80px; resize: vertical; font-family: inherit; }
        
        .form-row { display: flex; gap: 15px; align-items: center; margin: 15px 0; flex-wrap: wrap; }
        .form-group { margin: 20px 0; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748; }
        
        /* Messages */
        .message { padding: 15px; border-radius: 8px; margin: 15px 0; }
        .loading { background: #edf2f7; color: #4a5568; text-align: center; font-style: italic; }
        .error { background: #fed7d7; color: #c53030; border: 1px solid #feb2b2; }
        .success { background: #c6f6d5; color: #2f855a; border: 1px solid #9ae6b4; }
        .warning { background: #fefcbf; color: #b7791f; border: 1px solid #f6e05e; }
        .info { background: #bee3f8; color: #2b6cb0; border: 1px solid #90cdf4; }
        
        /* Search */
        .search-help { font-size: 12px; color: #718096; margin-top: 8px; font-style: italic; }
        
        /* Drop Zone */
        .drop-zone { min-height: 120px; border: 2px dashed #cbd5e0; padding: 30px; text-align: center; 
                    margin: 20px 0; border-radius: 8px; color: #718096; transition: all 0.2s; }
        .drop-zone.dragover { border-color: #667eea; background: #eef2ff; color: #667eea; }
        
        /* Rancher Preview Styles */
        .rancher-preview { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
                          background: #f5f5f5; min-height: 500px; }
        .rancher-header { background: #1976d2; color: white; padding: 20px; text-align: center; }
        .rancher-header h2 { margin: 0; font-size: 24px; }
        .rancher-subtitle { margin: 8px 0 0 0; opacity: 0.9; }
        .rancher-form { max-width: 800px; margin: 0 auto; padding: 20px; }
        .rancher-section { background: white; border: 1px solid #ddd; border-radius: 4px; 
                          margin-bottom: 20px; overflow: hidden; }
        .rancher-section-header { background: #f5f5f5; padding: 15px; border-bottom: 1px solid #ddd; }
        .rancher-section-title { margin: 0; color: #333; font-size: 16px; font-weight: 600; }
        .rancher-section-content { padding: 20px; }
        .rancher-field { margin-bottom: 20px; }
        .rancher-field-label { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .rancher-field-label label { font-weight: 500; color: #333; }
        .required { color: #d32f2f; font-weight: bold; }
        .conditional-badge { background: #ff9800; color: white; padding: 2px 6px; 
                           border-radius: 3px; font-size: 11px; }
        .rancher-field-description { color: #666; font-size: 14px; margin-bottom: 8px; }
        .rancher-input, .rancher-textarea, .rancher-select { width: 100%; padding: 8px 12px; 
                                                            border: 1px solid #ccc; border-radius: 4px; 
                                                            font-size: 14px; }
        .rancher-input:focus, .rancher-textarea:focus, .rancher-select:focus { 
            border-color: #1976d2; outline: none; box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2); }
        .rancher-textarea { min-height: 80px; resize: vertical; }
        .rancher-select-wrapper { position: relative; }
        .rancher-select-arrow { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); 
                               pointer-events: none; color: #666; }
        .rancher-checkbox-wrapper { display: flex; align-items: center; }
        .rancher-checkbox { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .rancher-checkbox input { margin: 0; }
        .rancher-field-meta { margin-top: 8px; font-size: 12px; color: #999; 
                             display: flex; gap: 12px; align-items: center; }
        .rancher-field-meta code { background: #f5f5f5; padding: 2px 4px; border-radius: 2px; }
        .show-if { background: #e3f2fd; color: #1976d2; padding: 2px 6px; border-radius: 3px; }
        .rancher-actions { margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; 
                          display: flex; gap: 12px; justify-content: flex-end; }
        .rancher-btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; 
                      font-size: 14px; font-weight: 500; }
        .rancher-btn-primary { background: #1976d2; color: white; }
        .rancher-btn-secondary { background: #f5f5f5; color: #333; border: 1px solid #ccc; }
        .icon-helm:before { content: '⛵'; margin-right: 8px; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; margin: 20px; padding: 30px; border-radius: 12px; 
                        width: 90%; max-width: 1000px; max-height: 80vh; overflow-y: auto; 
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; 
                       margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; }
        .close { font-size: 24px; cursor: pointer; color: #718096; }
        .close:hover { color: #2d3748; }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .main-content { grid-template-columns: 1fr; height: auto; }
            .repo-browser { grid-template-columns: 1fr; height: auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Rancher Questions Generator</h1>
            <p>Professional Helm chart questions.yaml authoring tool with enhanced repository management</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('repositories')">📦 Repositories</button>
            <button class="tab" onclick="showTab('browse')">🔍 Browse Charts</button>
            <button class="tab" onclick="showTab('direct-url')">🔗 Direct URL</button>
            <button class="tab" onclick="showTab('builder')" id="builderTab" style="display: none;">⚙️ Form Builder</button>
        </div>

        <!-- Repository Management Tab -->
        <div id="repositories" class="tab-content active">
            <div class="section">
                <h3>📋 Repository Management</h3>
                <div class="form-row">
                    <input type="text" id="repoName" placeholder="Repository Name">
                    <input type="text" id="repoUrl" placeholder="Repository URL (http://... or oci://...)">
                    <input type="text" id="repoDescription" placeholder="Description (optional)">
                </div>
                <div class="form-row">
                    <button onclick="toggleAuthSection()">🔐 Add Authentication</button>
                    <button class="btn-primary" onclick="addRepository()">➕ Add Repository</button>
                    <button class="btn-secondary" onclick="addCommonRepositories()">⚡ Add Common Repos</button>
                    <button onclick="promptForSUSERepo()" style="background: #0066cc;">🔒 Add SUSE App Collection</button>
                </div>
                
                <!-- Authentication Section (Hidden by default) -->
                <div id="authSection" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                    <h4>🔐 Authentication</h4>
                    <div class="form-row">
                        <input type="text" id="authUsername" placeholder="Username">
                        <input type="password" id="authPassword" placeholder="Password">
                    </div>
                    <div class="form-row">
                        <input type="text" id="authSecret" placeholder="Kubernetes Secret Name (optional)">
                    </div>
                    <div class="info">
                        <strong>💡 Credential Reuse:</strong> For OCI registries like SUSE Application Collection, 
                        credentials will be automatically reused for all charts from the same base URL 
                        (e.g., dp.apps.rancher.io).
                    </div>
                </div>
                
                <div id="repoStatus"></div>
            </div>

            <div class="section">
                <h3>📚 Available Repositories</h3>
                <div id="repositoriesList">
                    <div class="message loading">Loading repositories...</div>
                </div>
            </div>

            <div class="section">
                <h3>🔍 Search Charts</h3>
                <div class="form-row">
                    <input type="text" id="chartSearch" placeholder="Search charts...">
                    <select id="repoFilter">
                        <option value="">All Repositories</option>
                    </select>
                    <button class="btn-primary" onclick="searchCharts()">🔍 Search</button>
                </div>
                <div class="search-help">💡 Use wildcards: nginx*, *sql, *monitoring*</div>
                <div id="chartsList"></div>
            </div>
        </div>

        <!-- Browse Charts Tab -->
        <div id="browse" class="tab-content">
            <div class="section">
                <h3>🔍 Browse Repository Charts</h3>
                <div class="repo-browser">
                    <div class="repo-list">
                        <h4>Select Repository</h4>
                        <div id="browseRepoList"></div>
                    </div>
                    <div class="chart-list">
                        <h4>Available Charts</h4>
                        <div id="browseChartList">
                            <div class="message info">Select a repository to view available charts</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Direct URL Tab -->
        <div id="direct-url" class="tab-content">
            <div class="section">
                <h3>🔗 Direct Chart URL</h3>
                <p>Enter a direct URL to a Helm chart (.tgz)</p>
                <div class="form-row">
                    <input type="text" id="chartUrl" placeholder="https://example.com/chart.tgz">
                    <button class="btn-primary" onclick="loadChartFromUrl()">📥 Load Chart</button>
                </div>
                <div id="urlStatus"></div>
            </div>
        </div>

        <!-- Form Builder Tab -->
        <div id="builder" class="tab-content">
            <div class="main-content">
                <div class="panel values-panel">
                    <h3>📋 Values Explorer</h3>
                    <div style="margin-bottom: 15px;">
                        <label>
                            <input type="radio" name="valuesView" value="tree" checked onchange="toggleValuesDisplay()"> Tree View
                        </label>
                        <label style="margin-left: 15px;">
                            <input type="radio" name="valuesView" value="raw" onchange="toggleValuesDisplay()"> Raw YAML
                        </label>
                    </div>
                    <div id="valuesContent"></div>
                </div>
                
                <div class="panel form-builder" id="formBuilder" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>🛠️ Form Builder</h3>
                        <div>
                            <button class="btn-secondary btn-small" onclick="previewQuestions()">👀 Preview</button>
                            <button class="btn-primary btn-small" onclick="downloadYaml()">📥 Download</button>
                        </div>
                    </div>
                    
                    <div class="template-library">
                        <h4>📋 Question Templates & Sections</h4>
                        <div style="margin-bottom: 15px;">
                            <button class="btn-primary" onclick="initializeManualForm()" style="background: #38a169;">
                                📝 Start Manual Form Builder
                            </button>
                            <button class="btn-secondary" onclick="toggleAdvancedEditor()" style="margin-left: 10px;">
                                🔧 Advanced Question Editor
                            </button>
                        </div>
                        
                        <div class="template-grid">
                            <div class="template-item" onclick="addAICompareSection()">
                                <div class="template-title">🤖 AI Compare Configuration</div>
                                <div class="template-desc">Advanced AI setup with GPU, observability, and pipeline integration</div>
                                <div class="template-questions">9 questions with conditional logic</div>
                            </div>
                            <div class="template-item" onclick="addMainConfigSection()">
                                <div class="template-title">⚙️ Main Configuration</div>
                                <div class="template-desc">Primary application settings with advanced toggle</div>
                                <div class="template-questions">4 questions with show_if conditions</div>
                            </div>
                            <div class="template-item" onclick="addServiceSection()">
                                <div class="template-title">🔌 Service</div>
                                <div class="template-desc">Service type, ports, and load balancer configuration</div>
                                <div class="template-questions">4 questions</div>
                            </div>
                            <div class="template-item" onclick="addIngressSection()">
                                <div class="template-title">🌍 Ingress</div>
                                <div class="template-desc">Ingress controller, hostname, and external access</div>
                                <div class="template-questions">6 questions with dependencies</div>
                            </div>
                            <div class="template-item" onclick="addObservabilitySection()">
                                <div class="template-title">📊 Observability</div>
                                <div class="template-desc">OpenTelemetry, monitoring, and GPU stats collection</div>
                                <div class="template-questions">4 questions with dependencies</div>
                            </div>
                            <div class="template-item" onclick="addSecuritySection()">
                                <div class="template-title">🔒 Security</div>
                                <div class="template-desc">NeuVector integration and DLP configuration</div>
                                <div class="template-questions">5 questions with nested conditions</div>
                            </div>
                            <div class="template-item" onclick="addImageSection()">
                                <div class="template-title">🏗️ Images</div>
                                <div class="template-desc">Container image tags for all components</div>
                                <div class="template-questions">4 questions with advanced toggle</div>
                            </div>
                        </div>
                        
                        <div class="quick-add-buttons" style="margin-top: 15px;">
                            <button onclick="quickAddService()">🌐 Service</button>
                            <button onclick="quickAddStorage()">💾 Storage</button>
                            <button onclick="quickAddIngress()">🔗 Ingress</button>
                            <button onclick="quickAddResources()">⚡ Resources</button>
                            <button onclick="quickAddReplicas()">📊 Scaling</button>
                            <button onclick="quickAddPersistence()">🗄️ Persistence</button>
                            <button onclick="quickAddProbes()">❤️ Health Checks</button>
                            <button onclick="quickAddSecurity()">🔒 Security</button>
                            <button onclick="quickAddNodeAffinity()">📍 Scheduling</button>
                        </div>
                    </div>
                    
                    <div id="advancedEditor" class="advanced-editor" style="display: none;">
                        <h4>🔧 Advanced Question Editor</h4>
                        <div class="field-row">
                            <div class="field-group">
                                <label>Variable Path</label>
                                <input type="text" id="advVariable" placeholder="e.g., ollama.gpu.enabled">
                            </div>
                            <div class="field-group">
                                <label>Label</label>
                                <input type="text" id="advLabel" placeholder="e.g., Enable GPU">
                            </div>
                        </div>
                        <div class="field-group">
                            <label>Description</label>
                            <textarea id="advDescription" placeholder="Detailed description of the configuration option"></textarea>
                        </div>
                        <div class="field-row">
                            <div class="field-group">
                                <label>Type</label>
                                <select id="advType" onchange="handleTypeChange()">
                                    <option value="string">String</option>
                                    <option value="int">Integer</option>
                                    <option value="boolean">Boolean</option>
                                    <option value="enum">Dropdown (Enum)</option>
                                    <option value="password">Password</option>
                                </select>
                            </div>
                            <div class="field-group">
                                <label>Group</label>
                                <input type="text" id="advGroup" placeholder="e.g., Main Configuration">
                            </div>
                        </div>
                        <div class="field-row">
                            <div class="field-group">
                                <label>Default Value</label>
                                <input type="text" id="advDefault" placeholder="Default value">
                            </div>
                            <div class="field-group">
                                <label>Show If Condition</label>
                                <input type="text" id="advShowIf" placeholder="e.g., advancedConfig=true">
                            </div>
                        </div>
                        <div class="field-group">
                            <label>
                                <input type="checkbox" id="advRequired"> Required Field
                            </label>
                        </div>
                        <div id="enumOptions" class="options-editor" style="display: none;">
                            <label>Dropdown Options</label>
                            <div id="optionsList"></div>
                            <button type="button" class="add-option" onclick="addEnumOption()">+ Add Option</button>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn-primary" onclick="addAdvancedQuestion()">➕ Add Question</button>
                            <button class="btn-secondary" onclick="clearAdvancedEditor()">🗑️ Clear</button>
                        </div>
                    </div>
                    
                    <div class="drop-zone" id="dropZone">
                        <p>🎯 <strong>Drop values here</strong> to create questions<br>
                        <small>or use the Quick Add buttons above</small></p>
                    </div>
                    
                    <div id="questionsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>👀 Live Preview - Questions in Action</h2>
                <span class="close" onclick="closePreview()">&times;</span>
            </div>
            <div id="previewContent"></div>
        </div>
    </div>

    <script>
        let chartData = null;
        let selectedChart = null;
        let storageClasses = [];
        let repositories = [];

        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            loadRepositories();
            loadStorageClasses();
            searchCharts();
        });

        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'browse') {
                loadBrowseRepositories();
            }
        }

        // Repository management
        async function loadRepositories() {
            try {
                const response = await fetch('/api/repositories');
                const data = await response.json();
                repositories = data.repositories || [];
                
                displayRepositories();
                updateRepoFilter();
            } catch (error) {
                showMessage('repositoriesList', 'error', `Error loading repositories: ${error.message}`);
            }
        }

        function displayRepositories() {
            const container = document.getElementById('repositoriesList');
            const filterSelect = document.getElementById('repoFilter');
            
            if (repositories.length > 0) {
                container.innerHTML = repositories.map(repo => `
                    <div class="repo-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${repo.name}</strong>
                                <div style="font-size: 12px; color: #718096; margin-top: 4px;">${repo.url}</div>
                                <div style="font-size: 11px; color: #a0aec0; margin-top: 2px;">
                                    Added: ${new Date(repo.added_at).toLocaleDateString()}
                                </div>
                            </div>
                            <button class="btn-danger btn-small" onclick="removeRepository('${repo.name}')">Remove</button>
                        </div>
                    </div>
                `).join('');
                
                // Update filter dropdown
                filterSelect.innerHTML = '<option value="">All Repositories</option>' +
                    repositories.map(repo => 
                        `<option value="${repo.name}">${repo.name}</option>`
                    ).join('');
            } else {
                container.innerHTML = `
                    <div class="message info">
                        <p>No repositories configured yet.</p>
                        <button class="btn-primary" onclick="addCommonRepositories()">Add Common Repositories</button>
                    </div>
                `;
            }
        }

        function updateRepoFilter() {
            const filterSelect = document.getElementById('repoFilter');
            filterSelect.innerHTML = '<option value="">All Repositories</option>' +
                repositories.map(repo => 
                    `<option value="${repo.name}">${repo.name}</option>`
                ).join('');
        }

        function toggleAuthSection() {
            const authSection = document.getElementById('authSection');
            const isVisible = authSection.style.display !== 'none';
            authSection.style.display = isVisible ? 'none' : 'block';
        }

        async function addRepository() {
            const name = document.getElementById('repoName').value.trim();
            const url = document.getElementById('repoUrl').value.trim();
            const description = document.getElementById('repoDescription').value.trim();
            
            if (!name || !url) {
                showMessage('repoStatus', 'error', 'Please provide both name and URL');
                return;
            }

            // Check if authentication section is visible and get credentials
            const authSection = document.getElementById('authSection');
            let auth = null;
            
            if (authSection.style.display !== 'none') {
                const username = document.getElementById('authUsername').value.trim();
                const password = document.getElementById('authPassword').value.trim();
                const secretName = document.getElementById('authSecret').value.trim();
                
                if (username && password) {
                    auth = { username, password };
                } else if (secretName) {
                    auth = { secret_name: secretName };
                } else if (url.startsWith('oci://')) {
                    showMessage('repoStatus', 'error', 'OCI registries require authentication credentials');
                    return;
                }
            }

            const payload = { name, url };
            if (description) payload.description = description;
            if (auth) payload.auth = auth;

            try {
                const response = await fetch('/api/repositories', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    showMessage('repoStatus', 'success', 'Repository added successfully!');
                    // Clear form fields
                    document.getElementById('repoName').value = '';
                    document.getElementById('repoUrl').value = '';
                    document.getElementById('repoDescription').value = '';
                    document.getElementById('authUsername').value = '';
                    document.getElementById('authPassword').value = '';
                    document.getElementById('authSecret').value = '';
                    // Hide auth section
                    authSection.style.display = 'none';
                    loadRepositories();
                } else {
                    const data = await response.json();
                    throw new Error(data.error || 'Failed to add repository');
                }
            } catch (error) {
                showMessage('repoStatus', 'error', `Error: ${error.message}`);
            }
        }

        async function removeRepository(name) {
            if (!confirm(`Remove repository '${name}'?`)) return;

            try {
                const response = await fetch(`/api/repositories/${name}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    loadRepositories();
                } else {
                    const data = await response.json();
                    alert(`Error: ${data.error || 'Failed to remove repository'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        async function addCommonRepositories() {
            showMessage('repoStatus', 'loading', 'Refreshing repositories...');
            
            try {
                // The backend already has default repositories loaded, just refresh the display
                await loadRepositories();
                showMessage('repoStatus', 'success', 'Common repositories are already available! Check the list below.');
            } catch (error) {
                showMessage('repoStatus', 'error', `Error refreshing repositories: ${error.message}`);
            }
        }

        async function promptForSUSERepo() {
            // Check if SUSE Application Collection already exists
            const existingRepo = repositories.find(repo => repo.name === 'suse-application-collection');
            if (existingRepo) {
                showMessage('repoStatus', 'success', 'SUSE Application Collection is already configured and ready to use!');
                return;
            }
            
            const username = prompt('Enter your SUSE Application Collection username:');
            if (!username) return;
            
            const password = prompt('Enter your SUSE Application Collection password:');
            if (!password) return;
            
            const payload = {
                name: 'suse-application-collection-auth',
                url: 'oci://dp.apps.rancher.io/charts',
                description: 'SUSE Application Collection with Authentication',
                auth: { username, password }
            };
            
            try {
                const response = await fetch('/api/repositories', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (response.ok) {
                    showMessage('repoStatus', 'success', 'SUSE Application Collection added successfully! Credentials will be reused for all charts from dp.apps.rancher.io');
                    loadRepositories();
                } else {
                    const data = await response.json();
                    throw new Error(data.error || 'Failed to add SUSE Application Collection');
                }
            } catch (error) {
                showMessage('repoStatus', 'error', `Failed to add SUSE Application Collection: ${error.message}`);
            }
        }

        // Chart search and browsing
        async function searchCharts() {
            const query = document.getElementById('chartSearch').value.trim();
            const repository = document.getElementById('repoFilter').value;

            try {
                const params = new URLSearchParams();
                if (query) params.append('query', query);
                if (repository) params.append('repository', repository);

                const response = await fetch(`/api/charts/search?${params}`);
                const data = await response.json();

                displayCharts(data.charts || [], 'chartsList');
            } catch (error) {
                showMessage('chartsList', 'error', `Error searching charts: ${error.message}`);
            }
        }

        function displayCharts(charts, containerId) {
            const container = document.getElementById(containerId);
            
            if (charts.length > 0) {
                container.innerHTML = charts.map(chart => `
                    <div class="chart-item" onclick="selectChart('${chart.repository}', '${chart.name}', '${chart.version}')">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <strong>${chart.name}</strong>
                                <span style="color: #718096; margin-left: 10px;">v${chart.version}</span>
                                <div class="chart-meta">
                                    <div>Repository: <strong>${chart.repository}</strong></div>
                                    ${chart.app_version ? `<div>App Version: ${chart.app_version}</div>` : ''}
                                    ${chart.description ? `<div style="margin-top: 8px;">${chart.description}</div>` : ''}
                                    ${chart.keywords ? `<div style="margin-top: 4px;">Keywords: ${chart.keywords.join(', ')}</div>` : ''}
                                </div>
                            </div>
                            ${chart.versions ? `
                                <div class="chart-versions">
                                    <select class="version-selector" onclick="event.stopPropagation();" 
                                            onchange="updateSelectedVersion('${chart.repository}', '${chart.name}', this.value)">
                                        ${chart.versions.map(v => 
                                            `<option value="${v}" ${v === chart.version ? 'selected' : ''}>${v}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
                
                // Add process button if in search results
                if (containerId === 'chartsList') {
                    container.innerHTML += `
                        <div style="text-align: center; margin-top: 20px;">
                            <button id="processBtn" class="btn-primary" onclick="processSelectedChart()" style="display: none;">
                                🚀 Process Selected Chart
                            </button>
                        </div>
                    `;
                }
            } else {
                container.innerHTML = '<div class="message info">No charts found. Try a different search term.</div>';
            }
        }

        function selectChart(repository, chart, version) {
            // Remove previous selection
            document.querySelectorAll('.chart-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selection to clicked item
            event.currentTarget.classList.add('selected');
            
            selectedChart = { repository, chart, version };
            
            // Show process button
            const processBtn = document.getElementById('processBtn');
            if (processBtn) {
                processBtn.style.display = 'inline-block';
            }
        }

        function updateSelectedVersion(repository, chart, version) {
            if (selectedChart && selectedChart.repository === repository && selectedChart.chart === chart) {
                selectedChart.version = version;
            }
        }

        async function processSelectedChart() {
            if (!selectedChart) return;

            showMessage('chartsList', 'loading', 'Processing chart...');

            try {
                const response = await fetch('/api/charts/process', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(selectedChart)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to process chart');
                }

                chartData = await response.json();
                displayChart();
                
                // Show builder tab
                document.getElementById('builderTab').style.display = 'block';
                showTab('builder');
                
                // Clear the loading message
                const chartsList = document.getElementById('chartsList');
                const loadingMsg = chartsList.querySelector('.message.loading');
                if (loadingMsg) loadingMsg.remove();
                
            } catch (error) {
                showMessage('chartsList', 'error', `Error: ${error.message}`);
            }
        }

        // Browse repositories
        async function loadBrowseRepositories() {
            const container = document.getElementById('browseRepoList');
            
            if (repositories.length === 0) {
                container.innerHTML = '<div class="message info">No repositories available</div>';
                return;
            }
            
            container.innerHTML = repositories.map(repo => `
                <div class="repo-item" onclick="browseRepository('${repo.name}')">
                    <strong>${repo.name}</strong>
                    <div style="font-size: 12px; color: #718096; margin-top: 4px;">
                        ${repo.url}
                    </div>
                </div>
            `).join('');
        }

        async function browseRepository(repoName) {
            // Update selection
            document.querySelectorAll('#browseRepoList .repo-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            const container = document.getElementById('browseChartList');
            container.innerHTML = '<div class="message loading">Loading charts...</div>';
            
            try {
                const response = await fetch(`/api/repositories/${repoName}/charts`);
                const data = await response.json();
                
                displayCharts(data.charts || [], 'browseChartList');
            } catch (error) {
                container.innerHTML = `<div class="message error">Error loading charts: ${error.message}</div>`;
            }
        }

        // Direct URL processing (legacy)
        async function loadChartFromUrl() {
            const url = document.getElementById('chartUrl').value.trim();
            if (!url) return;

            showMessage('urlStatus', 'loading', 'Processing chart...');

            try {
                const response = await fetch('/api/chart', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to process chart');
                }

                chartData = await response.json();
                displayChart();
                
                document.getElementById('builderTab').style.display = 'block';
                showTab('builder');
                
                showMessage('urlStatus', 'success', 'Chart loaded successfully!');
            } catch (error) {
                showMessage('urlStatus', 'error', `Error: ${error.message}`);
            }
        }

        // Form builder functions
        function displayChart() {
            displayValues(chartData.values);
            displayQuestions(chartData.questions.questions);
        }

        function toggleValuesDisplay() {
            const view = document.querySelector('input[name="valuesView"]:checked').value;
            const container = document.getElementById('valuesContent');
            
            if (view === 'raw') {
                container.innerHTML = `<pre style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-size: 12px; overflow-x: auto;">${JSON.stringify(chartData.values, null, 2)}</pre>`;
            } else {
                displayValues(chartData.values);
            }
        }

        function displayValues(values) {
            const container = document.getElementById('valuesContent');
            container.innerHTML = '';
            container.className = 'values-tree';
            
            function renderValues(obj, path = '', level = 0) {
                for (const [key, value] of Object.entries(obj)) {
                    const fullPath = path ? `${path}.${key}` : key;
                    
                    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                        const div = document.createElement('div');
                        div.style.marginLeft = level * 20 + 'px';
                        div.style.marginTop = '8px';
                        div.innerHTML = `<strong style="color: #4a5568;">${key}/</strong> <span class="value-type">object</span>`;
                        container.appendChild(div);
                        renderValues(value, fullPath, level + 1);
                    } else {
                        const div = document.createElement('div');
                        div.className = 'value-item';
                        div.draggable = true;
                        div.dataset.path = fullPath;
                        div.dataset.value = JSON.stringify(value);
                        div.style.marginLeft = level * 20 + 'px';
                        
                        div.innerHTML = `
                            <div>
                                <span class="value-path">${fullPath}</span>
                                <span class="value-type">${Array.isArray(value) ? 'array' : typeof value}</span>
                            </div>
                            <div class="value-default">${Array.isArray(value) ? `[${value.length} items]` : String(value)}</div>
                        `;
                        
                        div.ondragstart = (e) => {
                            e.dataTransfer.setData('text/plain', JSON.stringify({
                                path: fullPath,
                                value: value
                            }));
                            div.classList.add('dragging');
                        };
                        
                        div.ondragend = () => {
                            div.classList.remove('dragging');
                        };
                        
                        container.appendChild(div);
                    }
                }
            }
            
            renderValues(values);
        }

        function displayQuestions(questions) {
            const container = document.getElementById('questionsContent');
            
            if (!questions || questions.length === 0) {
                container.innerHTML = '<div class="message info">No questions yet. Drag values from the left panel or use Quick Add buttons.</div>';
                return;
            }
            
            container.innerHTML = questions.map((question, index) => `
                <div class="question-item" data-index="${index}" draggable="true" 
                     ondragstart="startQuestionDrag(event, ${index})" 
                     ondragend="endQuestionDrag(event)"
                     ondragover="allowQuestionDrop(event)" 
                     ondrop="dropQuestion(event, ${index})">
                    <div class="question-header">
                        <div class="question-title">📋 ${question.label}</div>
                        <div class="question-controls">
                            <button class="btn-secondary btn-small" onclick="moveQuestionUp(${index})" ${index === 0 ? 'disabled' : ''}>⬆️</button>
                            <button class="btn-secondary btn-small" onclick="moveQuestionDown(${index})" ${index === questions.length - 1 ? 'disabled' : ''}>⬇️</button>
                            <button class="btn-secondary btn-small" onclick="editQuestion(${index})">✏️</button>
                            <button class="btn-danger btn-small" onclick="removeQuestion(${index})">🗑️</button>
                        </div>
                    </div>
                    
                    <div class="question-details">
                        <div><strong>Variable:</strong> ${question.variable}</div>
                        ${question.description ? `<div><strong>Description:</strong> ${question.description}</div>` : ''}
                        <div class="question-meta">
                            <span class="meta-tag">Type: ${question.type || 'string'}</span>
                            <span class="meta-tag">Group: ${question.group || 'General'}</span>
                            ${question.required ? '<span class="meta-tag" style="background: #fed7d7; color: #c53030;">Required</span>' : ''}
                            ${question.default !== undefined ? `<span class="meta-tag">Default: ${question.default}</span>` : ''}
                            ${question.show_if ? `<span class="meta-tag" style="background: #bee3f8; color: #2b6cb0;">Show If: ${question.show_if}</span>` : ''}
                            ${question.options ? `<span class="meta-tag" style="background: #c6f6d5; color: #2f855a;">${question.options.length} options</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="question-edit" id="edit-${index}">
                        <div class="form-group">
                            <label>Label</label>
                            <input type="text" id="label-${index}" value="${question.label}">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="description-${index}">${question.description || ''}</textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Type</label>
                                <select id="type-${index}">
                                    <option value="string" ${question.type === 'string' ? 'selected' : ''}>String</option>
                                    <option value="int" ${question.type === 'int' ? 'selected' : ''}>Integer</option>
                                    <option value="boolean" ${question.type === 'boolean' ? 'selected' : ''}>Boolean</option>
                                    <option value="enum" ${question.type === 'enum' ? 'selected' : ''}>Dropdown</option>
                                    <option value="password" ${question.type === 'password' ? 'selected' : ''}>Password</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Group</label>
                                <input type="text" id="group-${index}" value="${question.group || 'General'}">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Show If Condition</label>
                                <input type="text" id="showif-${index}" value="${question.show_if || ''}" placeholder="e.g., advancedConfig=true">
                            </div>
                            <div class="form-group">
                                <label>Default Value</label>
                                <input type="text" id="default-${index}" value="${question.default || ''}">
                            </div>
                        </div>
                        <div class="form-row">
                            <label>
                                <input type="checkbox" id="required-${index}" ${question.required ? 'checked' : ''}> Required
                            </label>
                        </div>
                        ${question.type === 'enum' ? `
                            <div class="form-group">
                                <label>Options (one per line)</label>
                                <textarea id="options-${index}" rows="4">${(question.options || []).join('\n')}</textarea>
                            </div>
                        ` : ''}
                        <div class="form-row">
                            <button class="btn-primary" onclick="saveQuestion(${index})">💾 Save</button>
                            <button class="btn-secondary" onclick="cancelEdit(${index})">❌ Cancel</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Drag and drop
        function allowDrop(ev) {
            ev.preventDefault();
            document.getElementById('dropZone').classList.add('dragover');
        }

        function drop(ev) {
            ev.preventDefault();
            document.getElementById('dropZone').classList.remove('dragover');
            
            const data = JSON.parse(ev.dataTransfer.getData('text/plain'));
            addQuestion(data.path, data.value);
        }

        // Remove dragover when leaving
        document.addEventListener('dragleave', (e) => {
            if (e.target.id === 'dropZone') {
                e.target.classList.remove('dragover');
            }
        });

        function addQuestion(path, value, customData = {}) {
            // Initialize chartData if it doesn't exist (for manual form building)
            if (!chartData) {
                initializeManualForm();
            }
            
            const newQuestion = {
                variable: path,
                label: customData.label || path.split('.').pop().replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()),
                description: customData.description || '',
                type: customData.type || (typeof value === 'boolean' ? 'boolean' : typeof value === 'number' ? 'int' : 'string'),
                required: customData.required || false,
                group: customData.group || 'General',
                ...customData
            };
            
            // Add show_if condition if provided
            if (customData.show_if) {
                newQuestion.show_if = customData.show_if;
            }
            
            // Add options for enum types
            if (customData.options && Array.isArray(customData.options)) {
                newQuestion.options = customData.options;
            }
            
            // Add default value if provided
            if (customData.default !== undefined) {
                newQuestion.default = customData.default;
            }
            
            chartData.questions.questions.push(newQuestion);
            displayQuestions(chartData.questions.questions);
            updateBackend();
        }

        function initializeManualForm() {
            chartData = {
                session_id: 'manual-' + Date.now(),
                chart_name: 'Custom Chart',
                questions: {
                    questions: []
                }
            };
            
            // Show the form builder section
            document.getElementById('formBuilder').style.display = 'block';
            document.getElementById('formBuilderContent').style.display = 'block';
            
            showMessage('formBuilderContent', 'success', '📝 Manual form builder initialized! Add questions using the Quick Add buttons or drag values from the repository browser.');
        }

        // Question management
        function editQuestion(index) {
            const editForm = document.getElementById(`edit-${index}`);
            editForm.classList.add('active');
        }

        function cancelEdit(index) {
            const editForm = document.getElementById(`edit-${index}`);
            editForm.classList.remove('active');
        }

        function saveQuestion(index) {
            const question = chartData.questions.questions[index];
            
            question.label = document.getElementById(`label-${index}`).value;
            question.description = document.getElementById(`description-${index}`).value;
            question.type = document.getElementById(`type-${index}`).value;
            question.group = document.getElementById(`group-${index}`).value;
            question.required = document.getElementById(`required-${index}`).checked;
            
            // Handle show_if condition
            const showIf = document.getElementById(`showif-${index}`).value.trim();
            if (showIf) {
                question.show_if = showIf;
            } else {
                delete question.show_if;
            }
            
            // Handle default value
            const defaultValue = document.getElementById(`default-${index}`).value.trim();
            if (defaultValue) {
                // Convert to appropriate type
                if (question.type === 'boolean') {
                    question.default = defaultValue.toLowerCase() === 'true';
                } else if (question.type === 'int') {
                    question.default = parseInt(defaultValue) || 0;
                } else {
                    question.default = defaultValue;
                }
            } else {
                delete question.default;
            }
            
            // Handle enum options
            if (question.type === 'enum') {
                const optionsText = document.getElementById(`options-${index}`).value.trim();
                if (optionsText) {
                    question.options = optionsText.split('\n').map(opt => opt.trim()).filter(opt => opt);
                } else {
                    delete question.options;
                }
            } else {
                delete question.options;
            }
            
            displayQuestions(chartData.questions.questions);
            updateBackend();
        }

        function removeQuestion(index) {
            if (confirm('Remove this question?')) {
                chartData.questions.questions.splice(index, 1);
                displayQuestions(chartData.questions.questions);
                updateBackend();
            }
        }

        // Quick add functions
        async function quickAddService() {
            addQuestion('service.type', 'LoadBalancer', {
                label: 'Service Type',
                description: 'Kubernetes service type for exposing the application',
                type: 'enum',
                options: ['LoadBalancer', 'NodePort', 'ClusterIP'],
                group: 'Networking'
            });
        }

        async function quickAddStorage() {
            await loadStorageClasses();
            const defaultClass = storageClasses.find(sc => sc.is_default);
            
            addQuestion('persistence.storageClass', defaultClass?.name || 'standard', {
                label: 'Storage Class',
                description: 'Storage class for persistent volumes',
                type: 'enum',
                options: storageClasses.map(sc => sc.name),
                group: 'Storage'
            });
        }

        function quickAddIngress() {
            // Add multiple ingress-related questions
            addQuestion('ingress.enabled', false, {
                label: 'Enable Ingress',
                description: 'Enable ingress for external access',
                type: 'boolean',
                group: 'Networking'
            });
            
            addQuestion('ingress.className', 'nginx', {
                label: 'Ingress Class',
                description: 'Ingress controller class name',
                type: 'enum',
                options: ['nginx', 'traefik', 'alb', 'gce'],
                group: 'Networking'
            });
            
            addQuestion('ingress.host', '', {
                label: 'Ingress Host',
                description: 'Hostname for ingress (e.g., app.example.com)',
                type: 'string',
                group: 'Networking'
            });
            
            addQuestion('ingress.tls.enabled', false, {
                label: 'Enable TLS',
                description: 'Enable TLS/SSL termination',
                type: 'boolean',
                group: 'Networking'
            });
            
            addQuestion('ingress.tls.secretName', '', {
                label: 'TLS Secret Name',
                description: 'Name of TLS certificate secret',
                type: 'string',
                group: 'Networking'
            });
        }

        function quickAddResources() {
            // Add comprehensive resource configuration
            addQuestion('resources.requests.memory', '256Mi', {
                label: 'Memory Request',
                description: 'Minimum memory allocation',
                type: 'string',
                group: 'Resources'
            });
            
            addQuestion('resources.requests.cpu', '100m', {
                label: 'CPU Request',
                description: 'Minimum CPU allocation',
                type: 'string',
                group: 'Resources'
            });
            
            addQuestion('resources.limits.memory', '512Mi', {
                label: 'Memory Limit',
                description: 'Maximum memory allocation',
                type: 'string',
                group: 'Resources'
            });
            
            addQuestion('resources.limits.cpu', '500m', {
                label: 'CPU Limit',
                description: 'Maximum CPU allocation',
                type: 'string',
                group: 'Resources'
            });
        }

        function quickAddReplicas() {
            addQuestion('replicaCount', 3, {
                label: 'Replica Count',
                description: 'Number of pod replicas',
                type: 'int',
                group: 'Scaling'
            });
            
            addQuestion('autoscaling.enabled', false, {
                label: 'Enable Autoscaling',
                description: 'Enable Horizontal Pod Autoscaler',
                type: 'boolean',
                group: 'Scaling'
            });
            
            addQuestion('autoscaling.minReplicas', 2, {
                label: 'Minimum Replicas',
                description: 'Minimum number of replicas for autoscaling',
                type: 'int',
                group: 'Scaling'
            });
            
            addQuestion('autoscaling.maxReplicas', 10, {
                label: 'Maximum Replicas', 
                description: 'Maximum number of replicas for autoscaling',
                type: 'int',
                group: 'Scaling'
            });
            
            addQuestion('autoscaling.targetCPUUtilizationPercentage', 80, {
                label: 'Target CPU Utilization (%)',
                description: 'Target CPU utilization percentage for autoscaling',
                type: 'int',
                group: 'Scaling'
            });
        }

        function quickAddPersistence() {
            addQuestion('persistence.enabled', true, {
                label: 'Enable Persistence',
                description: 'Enable persistent volume for data storage',
                type: 'boolean',
                group: 'Storage'
            });
            
            addQuestion('persistence.size', '10Gi', {
                label: 'Storage Size',
                description: 'Size of persistent volume',
                type: 'string',
                group: 'Storage'
            });
            
            addQuestion('persistence.accessMode', 'ReadWriteOnce', {
                label: 'Access Mode',
                description: 'Persistent volume access mode', 
                type: 'enum',
                options: ['ReadWriteOnce', 'ReadOnlyMany', 'ReadWriteMany'],
                group: 'Storage'
            });
        }

        function quickAddProbes() {
            addQuestion('livenessProbe.enabled', true, {
                label: 'Enable Liveness Probe',
                description: 'Enable liveness probe for pod health checking',
                type: 'boolean',
                group: 'Health Checks'
            });
            
            addQuestion('livenessProbe.httpGet.path', '/health', {
                label: 'Liveness Probe Path',
                description: 'HTTP path for liveness probe',
                type: 'string',
                group: 'Health Checks'
            });
            
            addQuestion('readinessProbe.enabled', true, {
                label: 'Enable Readiness Probe',
                description: 'Enable readiness probe for traffic routing',
                type: 'boolean',
                group: 'Health Checks'
            });
            
            addQuestion('readinessProbe.httpGet.path', '/ready', {
                label: 'Readiness Probe Path', 
                description: 'HTTP path for readiness probe',
                type: 'string',
                group: 'Health Checks'
            });
        }

        function quickAddSecurity() {
            addQuestion('securityContext.runAsNonRoot', true, {
                label: 'Run as Non-Root',
                description: 'Run container as non-root user',
                type: 'boolean',
                group: 'Security'
            });
            
            addQuestion('securityContext.runAsUser', 1000, {
                label: 'User ID',
                description: 'User ID to run the container',
                type: 'int',
                group: 'Security'
            });
            
            addQuestion('securityContext.fsGroup', 2000, {
                label: 'File System Group',
                description: 'File system group for volume permissions',
                type: 'int',
                group: 'Security'
            });
            
            addQuestion('podSecurityContext.seccompProfile.type', 'RuntimeDefault', {
                label: 'Seccomp Profile',
                description: 'Seccomp profile type',
                type: 'enum',
                options: ['RuntimeDefault', 'Localhost', 'Unconfined'],
                group: 'Security'
            });
        }

        function quickAddNodeAffinity() {
            addQuestion('nodeSelector.enabled', false, {
                label: 'Enable Node Selector',
                description: 'Schedule pods on specific nodes',
                type: 'boolean',
                group: 'Scheduling'
            });
            
            addQuestion('nodeSelector.key', 'kubernetes.io/arch', {
                label: 'Node Selector Key',
                description: 'Node selector label key',
                type: 'string',
                group: 'Scheduling'
            });
            
            addQuestion('nodeSelector.value', 'amd64', {
                label: 'Node Selector Value',
                description: 'Node selector label value',
                type: 'string',
                group: 'Scheduling'
            });
            
            addQuestion('tolerations.enabled', false, {
                label: 'Enable Tolerations',
                description: 'Allow scheduling on tainted nodes',
                type: 'boolean',
                group: 'Scheduling'
            });
        }

        // Storage classes
        async function loadStorageClasses() {
            try {
                const response = await fetch('/api/storage-classes');
                const data = await response.json();
                storageClasses = data.storage_classes || [];
            } catch (error) {
                console.error('Error loading storage classes:', error);
                storageClasses = [{ name: 'standard', is_default: true }];
            }
        }

        // Backend sync
        async function updateBackend() {
            if (!chartData) return;
            
            try {
                await fetch(`/api/chart/${chartData.session_id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(chartData.questions)
                });
            } catch (error) {
                console.error('Error updating questions:', error);
            }
        }

        // Download and preview
        async function downloadYaml() {
            if (!chartData) return;
            
            try {
                const response = await fetch(`/api/chart/${chartData.session_id}/q`);
                const yaml = await response.text();
                
                const blob = new Blob([yaml], { type: 'application/x-yaml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'questions.yaml';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                alert('Error downloading YAML: ' + error.message);
            }
        }

        async function previewQuestions() {
            if (!chartData) return;
            
            const modal = document.getElementById('previewModal');
            const content = document.getElementById('previewContent');
            
            // Generate Rancher-style preview
            const questions = chartData.questions.questions;
            const groupedQuestions = {};
            questions.forEach(q => {
                const group = q.group || 'General';
                if (!groupedQuestions[group]) groupedQuestions[group] = [];
                groupedQuestions[group].push(q);
            });
            
            content.innerHTML = `
                <div class="rancher-preview">
                    <div class="rancher-header">
                        <h2><i class="icon icon-helm"></i> Install Chart</h2>
                        <p class="rancher-subtitle">Configure your application settings</p>
                    </div>
                    
                    <div class="rancher-form">
                        ${Object.entries(groupedQuestions).map(([groupName, groupQuestions]) => `
                            <div class="rancher-section">
                                <div class="rancher-section-header">
                                    <h3 class="rancher-section-title">${groupName}</h3>
                                    <div class="rancher-section-divider"></div>
                                </div>
                                <div class="rancher-section-content">
                                    ${groupQuestions.map(q => `
                                        <div class="rancher-field ${q.show_if ? 'conditional' : ''}">
                                            <div class="rancher-field-label">
                                                <label>${q.label}</label>
                                                ${q.required ? '<span class="required">*</span>' : ''}
                                                ${q.show_if ? '<span class="conditional-badge">Conditional</span>' : ''}
                                            </div>
                                            ${q.description ? `<div class="rancher-field-description">${q.description}</div>` : ''}
                                            <div class="rancher-field-input">
                                                ${generateRancherPreviewInput(q)}
                                            </div>
                                            <div class="rancher-field-meta">
                                                <code>${q.variable}</code>
                                                ${q.show_if ? `<span class="show-if">Show if: ${q.show_if}</span>` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                        
                        <div class="rancher-actions">
                            <button class="rancher-btn rancher-btn-primary">Install</button>
                            <button class="rancher-btn rancher-btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function generatePreviewInput(question) {
            const baseStyle = 'width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;';
            
            switch (question.type) {
                case 'boolean':
                    return `<label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" ${question.default ? 'checked' : ''}> 
                        ${question.default ? 'Enabled' : 'Disabled'}
                    </label>`;
                case 'int':
                    return `<input type="number" value="${question.default || ''}" style="${baseStyle}">`;
                case 'enum':
                    const options = question.options || ['Option 1', 'Option 2', 'Option 3'];
                    return `<select style="${baseStyle}">
                        ${options.map(opt => {
                            const value = typeof opt === 'object' ? opt.value : opt;
                            const label = typeof opt === 'object' ? opt.label : opt;
                            return `<option value="${value}" ${value === question.default ? 'selected' : ''}>${label}</option>`;
                        }).join('')}
                    </select>`;
                case 'password':
                    return `<input type="password" value="${question.default || ''}" placeholder="Enter ${question.label.toLowerCase()}" style="${baseStyle}">`;
                default:
                    return `<input type="text" value="${question.default || ''}" placeholder="Enter ${question.label.toLowerCase()}" style="${baseStyle}">`;
            }
        }

        function generateRancherPreviewInput(question) {
            switch (question.type) {
                case 'boolean':
                    return `<div class="rancher-checkbox-wrapper">
                        <label class="rancher-checkbox">
                            <input type="checkbox" ${question.default === true ? 'checked' : ''}>
                            <span class="rancher-checkbox-custom"></span>
                            <span class="rancher-checkbox-label">${question.label}</span>
                        </label>
                    </div>`;
                case 'enum':
                    return `<div class="rancher-select-wrapper">
                        <select class="rancher-select">
                            <option value="">Select ${question.label}</option>
                            ${(question.options || []).map(opt => 
                                `<option value="${opt}" ${question.default === opt ? 'selected' : ''}>${opt}</option>`
                            ).join('')}
                        </select>
                        <i class="rancher-select-arrow">▼</i>
                    </div>`;
                case 'int':
                case 'float':
                    return `<input type="number" class="rancher-input" value="${question.default || ''}" placeholder="Enter ${question.type}">`;
                case 'multiline':
                    return `<textarea class="rancher-textarea" placeholder="Enter ${question.label.toLowerCase()}...">${question.default || ''}</textarea>`;
                case 'storageclass':
                    return `<div class="rancher-select-wrapper">
                        <select class="rancher-select">
                            <option value="">Default StorageClass</option>
                            <option value="longhorn">longhorn</option>
                            <option value="local-path">local-path</option>
                            <option value="nfs-client">nfs-client</option>
                        </select>
                        <i class="rancher-select-arrow">▼</i>
                    </div>`;
                default:
                    return `<input type="text" class="rancher-input" value="${question.default || ''}" placeholder="Enter ${question.label.toLowerCase()}">`;
            }
        }

        function closePreview() {
            document.getElementById('previewModal').classList.remove('active');
        }

        // Question reordering functions
        let draggedQuestionIndex = null;

        function startQuestionDrag(event, index) {
            draggedQuestionIndex = index;
            event.target.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
        }

        function endQuestionDrag(event) {
            event.target.classList.remove('dragging');
            document.querySelectorAll('.question-item').forEach(item => {
                item.classList.remove('drag-over');
            });
            draggedQuestionIndex = null;
        }

        function allowQuestionDrop(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
            if (event.currentTarget.classList.contains('question-item')) {
                event.currentTarget.classList.add('drag-over');
            }
        }

        function dropQuestion(event, targetIndex) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            if (draggedQuestionIndex !== null && draggedQuestionIndex !== targetIndex) {
                reorderQuestion(draggedQuestionIndex, targetIndex);
            }
        }

        function moveQuestionUp(index) {
            if (index > 0) {
                reorderQuestion(index, index - 1);
            }
        }

        function moveQuestionDown(index) {
            if (index < chartData.questions.questions.length - 1) {
                reorderQuestion(index, index + 1);
            }
        }

        function reorderQuestion(fromIndex, toIndex) {
            if (!chartData || !chartData.questions.questions) return;
            
            const questions = chartData.questions.questions;
            const movedQuestion = questions.splice(fromIndex, 1)[0];
            questions.splice(toIndex, 0, movedQuestion);
            
            // Update the chart data
            updateChartData();
            displayQuestions(questions);
        }

        // Utility functions
        function showMessage(containerId, type, message) {
            const container = document.getElementById(containerId);
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = message;
            
            // Remove existing messages
            const existingMessages = container.querySelectorAll('.message');
            existingMessages.forEach(msg => msg.remove());
            
            container.appendChild(messageDiv);
            
            // Auto-remove success messages
            if (type === 'success') {
                setTimeout(() => messageDiv.remove(), 5000);
            }
        }

        // Advanced Question Editor Functions
        function toggleAdvancedEditor() {
            const editor = document.getElementById('advancedEditor');
            editor.style.display = editor.style.display === 'none' ? 'block' : 'none';
        }
        
        function handleTypeChange() {
            const type = document.getElementById('advType').value;
            const enumOptions = document.getElementById('enumOptions');
            enumOptions.style.display = type === 'enum' ? 'block' : 'none';
        }
        
        function addEnumOption() {
            const optionsList = document.getElementById('optionsList');
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-item';
            optionDiv.innerHTML = `
                <input type="text" placeholder="Option label" class="option-label">
                <input type="text" placeholder="Option value" class="option-value">
                <button type="button" class="remove-option" onclick="this.parentElement.remove()">−</button>
            `;
            optionsList.appendChild(optionDiv);
        }
        
        function clearAdvancedEditor() {
            document.getElementById('advVariable').value = '';
            document.getElementById('advLabel').value = '';
            document.getElementById('advDescription').value = '';
            document.getElementById('advType').value = 'string';
            document.getElementById('advGroup').value = '';
            document.getElementById('advDefault').value = '';
            document.getElementById('advShowIf').value = '';
            document.getElementById('advRequired').checked = false;
            document.getElementById('optionsList').innerHTML = '';
            handleTypeChange();
        }
        
        function addAdvancedQuestion() {
            const variable = document.getElementById('advVariable').value.trim();
            const label = document.getElementById('advLabel').value.trim();
            const description = document.getElementById('advDescription').value.trim();
            const type = document.getElementById('advType').value;
            const group = document.getElementById('advGroup').value.trim();
            const defaultValue = document.getElementById('advDefault').value.trim();
            const showIf = document.getElementById('advShowIf').value.trim();
            const required = document.getElementById('advRequired').checked;
            
            if (!variable || !label) {
                alert('Variable and Label are required');
                return;
            }
            
            const questionData = {
                label,
                description,
                type,
                group: group || 'General',
                required
            };
            
            if (defaultValue) {
                if (type === 'boolean') {
                    questionData.default = defaultValue.toLowerCase() === 'true';
                } else if (type === 'int') {
                    questionData.default = parseInt(defaultValue) || 0;
                } else {
                    questionData.default = defaultValue;
                }
            }
            
            if (showIf) {
                questionData.show_if = showIf;
            }
            
            if (type === 'enum') {
                const optionItems = document.querySelectorAll('.option-item');
                const options = [];
                optionItems.forEach(item => {
                    const label = item.querySelector('.option-label').value.trim();
                    const value = item.querySelector('.option-value').value.trim();
                    if (label && value) {
                        options.push({ label, value });
                    } else if (label) {
                        options.push(label);
                    }
                });
                if (options.length > 0) {
                    questionData.options = options;
                }
            }
            
            addQuestion(variable, questionData.default || '', questionData);
            clearAdvancedEditor();
        }
        
        // AI Compare Section Template
        function addAICompareSection() {
            const questions = [
                {
                    variable: 'advancedConfig',
                    label: 'Enable Advanced',
                    description: 'Show advanced settings like Images, Pipeline Integration, and Automation. Keep disabled for simplified deployment.',
                    type: 'boolean',
                    default: false,
                    group: 'Main Configuration'
                },
                {
                    variable: 'ollama.gpu.enabled',
                    label: 'Enable GPU',
                    description: 'Enable GPU acceleration for Ollama. Requires a node with GPU drivers and the k8s device plugin installed.',
                    type: 'boolean',
                    default: false,
                    group: 'Main Configuration'
                },
                {
                    variable: 'ollama.hardware.type',
                    label: 'Ollama GPU Type',
                    description: 'Select the target GPU hardware architecture for the Ollama deployment.',
                    type: 'enum',
                    required: true,
                    default: 'nvidia',
                    show_if: 'ollama.gpu.enabled=true',
                    options: [
                        { label: 'NVIDIA GPU (amd64)', value: 'nvidia' },
                        { label: 'Apple Silicon / CPU (arm64)', value: 'apple' }
                    ],
                    group: 'Main Configuration'
                },
                {
                    variable: 'frontend.enabled',
                    label: 'Enable Load Simulator',
                    description: 'Deploy HTTP load simulator for traffic generation and observability monitoring. Shows detailed settings when enabled.',
                    type: 'boolean',
                    default: false,
                    group: 'Main Configuration'
                },
                {
                    variable: 'aiCompare.observability.enabled',
                    label: 'Enable Observability',
                    description: 'Enable OpenTelemetry observability for GenAI monitoring, cost tracking, and performance metrics. Shows detailed settings when enabled.',
                    type: 'boolean',
                    default: false,
                    group: 'Main Configuration'
                },
                {
                    variable: 'ollama.resources.requests.cpu',
                    label: 'Ollama CPU Request',
                    description: 'The amount of CPU to reserve for the main Ollama container (e.g., \'500m\', \'1\').',
                    type: 'string',
                    default: '2',
                    show_if: 'advancedConfig=true',
                    group: 'Ollama Settings'
                },
                {
                    variable: 'ollama.resources.requests.memory',
                    label: 'Ollama Memory Request',
                    description: 'The amount of memory to reserve for the main Ollama container (e.g., \'1Gi\', \'2048Mi\').',
                    type: 'string',
                    default: '2Gi',
                    show_if: 'advancedConfig=true',
                    group: 'Ollama Settings'
                },
                {
                    variable: 'ollama.persistence.enabled',
                    label: 'Enable Ollama Model Persistence',
                    description: 'If true, a PersistentVolumeClaim will be created to store Ollama models.',
                    type: 'boolean',
                    default: false,
                    group: 'Ollama Settings'
                },
                {
                    variable: 'ollama.persistence.size',
                    label: 'Ollama Model Storage Size',
                    description: 'The size of the PersistentVolumeClaim for Ollama models (e.g., \'10Gi\', \'50Gi\').',
                    type: 'string',
                    default: '10Gi',
                    show_if: 'ollama.persistence.enabled=true',
                    group: 'Ollama Settings'
                }
            ];
            
            questions.forEach(q => {
                addQuestion(q.variable, q.default, q);
            });
        }
        
        // Main Configuration Section
        function addMainConfigSection() {
            const questions = [
                {
                    variable: 'advancedConfig',
                    label: 'Enable Advanced',
                    description: 'Show advanced settings. Keep disabled for simplified deployment.',
                    type: 'boolean',
                    default: false,
                    group: 'Main Configuration'
                },
                {
                    variable: 'app.name',
                    label: 'Application Name',
                    description: 'Name of the application deployment',
                    type: 'string',
                    required: true,
                    group: 'Main Configuration'
                },
                {
                    variable: 'app.version',
                    label: 'Application Version',
                    description: 'Version tag for the application',
                    type: 'string',
                    default: 'latest',
                    show_if: 'advancedConfig=true',
                    group: 'Main Configuration'
                },
                {
                    variable: 'app.environment',
                    label: 'Environment',
                    description: 'Deployment environment',
                    type: 'enum',
                    default: 'production',
                    options: ['development', 'staging', 'production'],
                    group: 'Main Configuration'
                }
            ];
            
            questions.forEach(q => {
                addQuestion(q.variable, q.default, q);
            });
        }
        
        // Service Section
        function addServiceSection() {
            const questions = [
                {
                    variable: 'service.type',
                    label: 'Service Type',
                    description: 'Method to expose the service within the cluster or externally.',
                    type: 'enum',
                    required: true,
                    default: 'LoadBalancer',
                    options: ['ClusterIP', 'NodePort', 'LoadBalancer'],
                    group: 'Service Configuration'
                },
                {
                    variable: 'service.port',
                    label: 'Service Port',
                    description: 'Port number for the service',
                    type: 'int',
                    default: 8080,
                    required: true,
                    group: 'Service Configuration'
                },
                {
                    variable: 'service.targetPort',
                    label: 'Target Port',
                    description: 'Port number on the pod that receives traffic',
                    type: 'int',
                    default: 8080,
                    group: 'Service Configuration'
                },
                {
                    variable: 'service.nodePort',
                    label: 'Node Port',
                    description: 'Static port on each node (30000-32767). Only used with NodePort service type.',
                    type: 'int',
                    show_if: 'service.type=NodePort',
                    group: 'Service Configuration'
                }
            ];
            
            questions.forEach(q => {
                addQuestion(q.variable, q.default, q);
            });
        }
        
        // Ingress Section
        function addIngressSection() {
            const questions = [
                {
                    variable: 'ingress.enabled',
                    label: 'Enable Ingress',
                    description: 'Enable ingress for external HTTP/HTTPS access',
                    type: 'boolean',
                    default: false,
                    group: 'Ingress Configuration'
                },
                {
                    variable: 'ingress.className',
                    label: 'Ingress Class',
                    description: 'Ingress controller class name',
                    type: 'enum',
                    default: 'nginx',
                    show_if: 'ingress.enabled=true',
                    options: ['nginx', 'traefik', 'haproxy', 'istio', 'alb', 'gce'],
                    group: 'Ingress Configuration'
                },
                {
                    variable: 'ingress.host',
                    label: 'Ingress Host',
                    description: 'Hostname for ingress (e.g., app.example.com)',
                    type: 'string',
                    show_if: 'ingress.enabled=true',
                    required: true,
                    group: 'Ingress Configuration'
                },
                {
                    variable: 'ingress.path',
                    label: 'Ingress Path',
                    description: 'URL path for the ingress rule',
                    type: 'string',
                    default: '/',
                    show_if: 'ingress.enabled=true',
                    group: 'Ingress Configuration'
                },
                {
                    variable: 'ingress.tls.enabled',
                    label: 'Enable TLS/SSL',
                    description: 'Enable HTTPS with TLS termination',
                    type: 'boolean',
                    default: false,
                    show_if: 'ingress.enabled=true',
                    group: 'Ingress Configuration'
                },
                {
                    variable: 'ingress.tls.secretName',
                    label: 'TLS Secret Name',
                    description: 'Name of the Kubernetes secret containing TLS certificate',
                    type: 'string',
                    show_if: 'ingress.tls.enabled=true',
                    group: 'Ingress Configuration'
                }
            ];
            
            questions.forEach(q => {
                addQuestion(q.variable, q.default, q);
            });
        }
        
        // Observability Section
        function addObservabilitySection() {
            const questions = [
                {
                    variable: 'observability.enabled',
                    label: 'Enable OpenTelemetry Observability',
                    description: 'Enable OpenLIT observability for request tracing, monitoring, and performance metrics.',
                    type: 'boolean',
                    default: false,
                    group: 'Observability Settings'
                },
                {
                    variable: 'observability.otlpEndpoint',
                    label: 'OpenTelemetry Collector Endpoint',
                    description: 'OTLP endpoint URL for sending telemetry data',
                    type: 'string',
                    default: 'http://opentelemetry-collector.observability.svc.cluster.local:4318',
                    show_if: 'observability.enabled=true',
                    group: 'Observability Settings'
                },
                {
                    variable: 'observability.collectGpuStats',
                    label: 'Enable GPU Statistics Collection',
                    description: 'Collect GPU utilization and memory usage statistics. Requires GPU nodes.',
                    type: 'boolean',
                    default: false,
                    show_if: 'observability.enabled=true',
                    group: 'Observability Settings'
                },
                {
                    variable: 'observability.sampleRate',
                    label: 'Trace Sample Rate',
                    description: 'Percentage of traces to sample (0.0 to 1.0)',
                    type: 'string',
                    default: '0.1',
                    show_if: 'observability.enabled=true',
                    group: 'Observability Settings'
                }
            ];
            
            questions.forEach(q => {
                addQuestion(q.variable, q.default, q);
            });
        }
        
        // Security Section
        function addSecuritySection() {
            const questions = [
                {
                    variable: 'security.enabled',
                    label: 'Enable Security Features',
                    description: 'Enable advanced security configurations and integrations',
                    type: 'boolean',
                    default: false,
                    group: 'Security Settings'
                },
                {
                    variable: 'security.neuvector.enabled',
                    label: 'Enable NeuVector Integration',
                    description: 'Automatically configure NeuVector DLP sensors. Requires NeuVector to be deployed.',
                    type: 'boolean',
                    default: false,
                    show_if: 'security.enabled=true',
                    group: 'Security Settings'
                },
                {
                    variable: 'security.neuvector.controllerUrl',
                    label: 'NeuVector Controller URL',
                    description: 'URL to the NeuVector controller service for API configuration',
                    type: 'string',
                    default: 'https://neuvector-svc-controller.neuvector.svc.cluster.local:10443',
                    show_if: 'security.neuvector.enabled=true',
                    group: 'Security Settings'
                },
                {
                    variable: 'security.neuvector.username',
                    label: 'NeuVector Admin Username',
                    description: 'Administrative username for NeuVector API access',
                    type: 'string',
                    default: 'admin',
                    show_if: 'security.neuvector.enabled=true',
                    group: 'Security Settings'
                },
                {
                    variable: 'security.neuvector.password',
                    label: 'NeuVector Admin Password',
                    description: 'Administrative password for NeuVector API access',
                    type: 'password',
                    default: 'admin',
                    show_if: 'security.neuvector.enabled=true',
                    group: 'Security Settings'
                }
            ];
            
            questions.forEach(q => {
                addQuestion(q.variable, q.default, q);
            });
        }
        
        // Images Section
        function addImageSection() {
            const questions = [
                {
                    variable: 'image.repository',
                    label: 'Container Image Repository',
                    description: 'Container image repository URL',
                    type: 'string',
                    required: true,
                    group: 'Images'
                },
                {
                    variable: 'image.tag',
                    label: 'Image Tag',
                    description: 'Container image tag',
                    type: 'string',
                    default: 'latest',
                    show_if: 'advancedConfig=true',
                    group: 'Images'
                },
                {
                    variable: 'image.pullPolicy',
                    label: 'Image Pull Policy',
                    description: 'Kubernetes image pull policy',
                    type: 'enum',
                    default: 'IfNotPresent',
                    show_if: 'advancedConfig=true',
                    options: ['Always', 'IfNotPresent', 'Never'],
                    group: 'Images'
                },
                {
                    variable: 'imagePullSecrets',
                    label: 'Image Pull Secrets',
                    description: 'Kubernetes secrets for private registries (comma-separated)',
                    type: 'string',
                    show_if: 'advancedConfig=true',
                    group: 'Images'
                }
            ];
            
            questions.forEach(q => {
                addQuestion(q.variable, q.default, q);
            });
        }
        
        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('previewModal');
            if (event.target === modal) {
                closePreview();
            }
        }
    </script>
</body>
</html>